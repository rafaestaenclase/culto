<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Botonera de Sonidos</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
    }

    body {
      height: 80vh;
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      background: #0f0f0f;
      color: #fff;
    }

    h2 {
      padding: 12px;
      margin-bottom: 10px;
      text-align: center;
      background: #181818;
      border-bottom: 1px solid #222;
    }

    #loader {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f0f0f;
      color: #ff9800;
      font-size: 20px;
    }


    .container {
      padding-bottom: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 0 10px;
    }

    button {
      aspect-ratio: 1 / 1;
      background: #222;
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: 
        transform 0.1s,
        background 0.2s,
        box-shadow 0.2s;
    }

    button:active {
      transform: scale(0.96);
    }

    /* ðŸ”¥ BOTÃ“N ACTIVO */
    button.active {
      background: #ff9800;
      box-shadow: 0 0 12px rgba(255, 152, 0, 0.7);
      color: #000;
    }

    /* Diferenciamos mÃºsica */
    button.music.active {
      background: #4caf50;
      box-shadow: 0 0 14px rgba(76, 175, 80, 0.8);
      color: #000;
    }
  </style>
</head>

<body>

  <div id="loader">
    <h2>Cargando sonidos...</h2>
  </div>

  <div id="app" style="display:none">
    <div class="container">
      <h2>Efectos</h2>
      <div id="effectsGrid" class="grid"></div>
    </div>

    <div class="container">
      <h2>MÃºsica</h2>
      <div id="musicGrid" class="grid"></div>
    </div>
  </div>

<script>
  /* ======================
     CONFIG
  ====================== */

  const FADE_TIME = 2000;
  const MAX_VOLUME = 1;
  const FADE_STEPS = 30;

  const effects = [
    { title: 'Agua', src: './efx/agua.mp3' },
    { title: 'Moviendo Piedra', src: './efx/moviendoPiedra.mp3' }
  ];

  const musicas = [
    { title: 'Fiesta', src: './music/fiesta.mp3' },
    { title: 'Ãrabe', src: './music/arabe.mp3' }
  ];

  /* ======================
     PRELOAD
  ====================== */

  const allAudios = [];
  let loadedAudios = 0;
  const totalAudios = effects.length + musicas.length;

  function preloadAudio(src, loop = false) {
    return new Promise((resolve, reject) => {
      const audio = new Audio();
      audio.src = src;
      audio.loop = loop;
      audio.preload = 'auto';

      audio.addEventListener('canplaythrough', () => {
        resolve(audio);
      }, { once: true });

      audio.addEventListener('error', () => {
        reject(new Error(`âŒ No se pudo cargar el archivo:\n${src}`));
      }, { once: true });
    });
  }

  async function preloadAll() {
    try {
      for (const e of effects) {
        e.audio = await preloadAudio(e.src);
      }

      for (const m of musicas) {
        m.audio = await preloadAudio(m.src, true);
      }

      document.getElementById('loader').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      initUI();

    } catch (error) {
      alert(error.message);
      console.error(error);
    }
  }

  /* ======================
     FADE
  ====================== */

  function fadeOut(audio, callback) {
    let step = audio.volume / FADE_STEPS;
    let interval = FADE_TIME / FADE_STEPS;

    const fade = setInterval(() => {
      audio.volume = Math.max(0, audio.volume - step);
      if (audio.volume <= 0) {
        clearInterval(fade);
        audio.pause();
        audio.currentTime = 0;
        callback && callback();
      }
    }, interval);
  }

  function fadeIn(audio) {
    audio.volume = 0;
    audio.play();

    let step = MAX_VOLUME / FADE_STEPS;
    let interval = FADE_TIME / FADE_STEPS;

    const fade = setInterval(() => {
      audio.volume = Math.min(MAX_VOLUME, audio.volume + step);
      if (audio.volume >= MAX_VOLUME) clearInterval(fade);
    }, interval);
  }

  /* ======================
     UI
  ====================== */

  let currentMusic = null;
  let currentMusicButton = null;

  function initUI() {
    const effectsGrid = document.getElementById('effectsGrid');
    const musicGrid = document.getElementById('musicGrid');

    effects.forEach(effect => {
      const btn = document.createElement('button');
      btn.textContent = effect.title;

      btn.onclick = () => {
        effect.audio.currentTime = 0;
        btn.classList.add('active');
        effect.audio.play();

        effect.audio.onended = () => {
          btn.classList.remove('active');
        };
      };

      effectsGrid.appendChild(btn);
    });

    musicas.forEach(musica => {
      const btn = document.createElement('button');
      btn.textContent = musica.title;
      btn.classList.add('music');

      btn.onclick = () => {
        if (currentMusic === musica.audio) return;

        if (currentMusic) {
          fadeOut(currentMusic);
          currentMusicButton.classList.remove('active');
        }

        currentMusic = musica.audio;
        currentMusicButton = btn;

        btn.classList.add('active');
        fadeIn(musica.audio);
      };

      musicGrid.appendChild(btn);
    });
  }

  /* ======================
     START
  ====================== */

  preloadAll();
</script>


</body>
</html>
