<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Botonera de Sonidos</title>

<style>

  html {
    margin-bottom: 300px;
  }

  
* { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, sans-serif; }
body {
  height: 100vh;
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  background: #0f0f0f;
  color: #fff;
}
h2 {
  padding: 10px;
  text-align: center;
  background: #181818;
  border-bottom: 1px solid #222;
}

#loader {
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ff9800;
}

.container { padding-bottom: 10px; }

.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  padding: 10px;
}

button {
  position: relative;
  aspect-ratio: 1 / 1;
  background: #222;
  border: none;
  border-radius: 12px;
  color: #fff;
  font-size: 13px;
  cursor: pointer;
  transition: transform 0.1s, background 0.2s, box-shadow 0.2s;
}

button:active { transform: scale(0.96); }

button.active {
  background: #ff9800;
  color: #000;
  box-shadow: 0 0 12px rgba(255,152,0,.7);
}

button.music.active {
  background: #4caf50;
  box-shadow: 0 0 14px rgba(76,175,80,.8);
}

button.selected {
  outline: 2px solid #00bcd4;
}

.volume-badge {
  position: absolute;
  bottom: 6px;
  right: 6px;
  background: rgba(0,0,0,.6);
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 11px;
}

/* Volume Slider */
#volumePanel {
  padding: 10px;
  background: #181818;
  border-top: 1px solid #222;
  position: fixed;
  bottom: 0;
  width: 100%;
}

#volumePanel input[type="range"] {
  width: 100%;
}
</style>
</head>

<body>

<div id="loader"><h2>Cargando sonidos...</h2></div>

<div id="app" style="display:none">

  <div class="container">
    <h2>Efectos</h2>
    <div id="effectsGrid" class="grid"></div>
  </div>

  <div class="container">
    <h2>MÃºsica</h2>
    <div id="musicGrid" class="grid"></div>
  </div>

  <div class="container">
    <h2>Ambiente</h2>
    <div id="ambienceGrid" class="grid"></div>
  </div>

  <div id="volumePanel">
    <input id="volumeSlider" type="range" min="0" max="1" step="0.01">
  </div>

</div>

<script>
/* ======================
   CONFIG
====================== */

const DEFAULT_VOLUME = 0.7;
const STORAGE_KEY = 'soundVolumes';

const effects = [
  { id:'agua', title:'ðŸ’§ Agua', src:'./efx/agua.mp3' },
  { id:'piedra', title:'ðŸª¨ Piedra', src:'./efx/moviendoPiedra.mp3' },
  { id:'clavo', title:'ðŸ”© Clavo', src:'./efx/clavo.mp3' },
  { id:'impacto', title:'ðŸ’¥ Impacto', src:'./efx/impactante.mp3' },
  { id:'latigo', title:'ðŸŒ€ LÃ¡tigo', src:'./efx/latigo.mp3' },
  { id:'llanto', title:'ðŸ˜¢ Llanto', src:'./efx/llantoMujer.mp3' }
];

const musicas = [
  { id:'fiesta', title:'ðŸŽ‰ Fiesta', src:'./music/fiesta.mp3' },
  { id:'arabe', title:'ðŸ•Œ Ãrabe', src:'./music/arabe.mp3' },
  { id:'vino', title:'Se acabÃ³ el vino', src:'./music/seAcaboElVino.mp3' },
  { id:'marta1', title:'Marta habla', src:'./music/martaHablaConJesus.mp3' },
  { id:'marta2', title:'Marta JesÃºs 2', src:'./music/martaJesus2.mp3' },
  { id:'manto', title:'Mujer Manto', src:'./music/mujerManto.mp3' },
  { id:'centurion', title:'CenturiÃ³n', src:'./music/centurion.mp3' }
];

const ambientes = [
  { id:'abucheos', title:'ðŸ“£ Abucheos', src:'./ambient/genteAbucheos.mp3' },
  { id:'llantoMulti', title:'ðŸ˜­ Multitud', src:'./ambient/genteLlorando.mp3' },
  { id:'murmullo', title:'ðŸ—£ï¸ Murmullo', src:'./ambient/genteHablando.mp3' },
  { id:'rayos', title:'âš¡ Tormenta', src:'./ambient/rayos.mp3' },
  { id:'soldados', title:'ðŸ¥¾ Soldados', src:'./ambient/soldadosMarchando.mp3' },
  { id:'temblor', title:'ðŸŒ‹ Temblores', src:'./ambient/temblores.mp3' },
  { id:'viento', title:'ðŸŒ¬ï¸ Viento', src:'./ambient/vientoDesierto.mp3' }
];

/* ======================
   VOLUME STORE
====================== */

const volumeStore = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

function getVolume(id) {
  return volumeStore[id] ?? DEFAULT_VOLUME;
}

function setVolume(id, value) {
  volumeStore[id] = value;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(volumeStore));
}

/* ======================
   PRELOAD
====================== */

function preload(src, loop=false) {
  return new Promise(res=>{
    const a = new Audio(src);
    a.loop = loop;
    a.preload = 'auto';
    a.oncanplaythrough = () => res(a);
  });
}

async function preloadAll() {
  for (const e of effects) e.audio = await preload(e.src);
  for (const m of musicas) m.audio = await preload(m.src,true);
  for (const a of ambientes) a.audio = await preload(a.src,true);

  document.getElementById('loader').style.display='none';
  document.getElementById('app').style.display='block';
  initUI();
}

/* ======================
   UI + LOGIC
====================== */

const slider = document.getElementById('volumeSlider');
let selected = null;

function selectSound(sound, btn) {
  document.querySelectorAll('.selected').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  selected = sound;
  slider.value = getVolume(sound.id);
}

slider.oninput = () => {
  if (!selected) return;
  const v = parseFloat(slider.value);
  setVolume(selected.id, v);
  selected.audio.volume = v;
  selected.badge.textContent = Math.round(v*100)+'%';
};

function createButton(sound, grid, onClick, extraClass='') {
  const btn = document.createElement('button');
  if (extraClass) btn.classList.add(extraClass);
  btn.textContent = sound.title;

  const badge = document.createElement('div');
  badge.className = 'volume-badge';
  badge.textContent = Math.round(getVolume(sound.id)*100)+'%';
  btn.appendChild(badge);

  sound.badge = badge;
  sound.audio.volume = getVolume(sound.id);

  btn.onclick = () => {
    selectSound(sound, btn);
    onClick(btn);
  };

  grid.appendChild(btn);
}

/* ======================
   INIT
====================== */

function initUI() {
  const eGrid = effectsGrid;
  effects.forEach(e=>{
    createButton(e, eGrid, (btn)=>{
      const s = e.audio.cloneNode();
      s.volume = getVolume(e.id);

      btn.classList.add('active');
      s.play();

      s.onended = () => {
        btn.classList.remove('active');
      };
    });
  });


  let currentMusic=null, currentBtn=null;

  musicas.forEach(m=>{
    createButton(m,musicGrid,(btn)=>{
      if (currentMusic===m.audio) {
        m.audio.pause(); m.audio.currentTime=0;
        btn.classList.remove('active');
        currentMusic=null; currentBtn=null;
        return;
      }
      if (currentMusic) {
        currentMusic.pause();
        currentBtn.classList.remove('active');
      }
      currentMusic=m.audio;
      currentBtn=btn;
      btn.classList.add('active');
      m.audio.currentTime=0;
      m.audio.volume=getVolume(m.id);
      m.audio.play();
    },'music');
  });

  ambientes.forEach(a=>{
    let playing = false;

    createButton(a, ambienceGrid, (btn)=>{
      if (!playing) {
        a.audio.volume = getVolume(a.id);
        a.audio.play();
        btn.classList.add('active');
        playing = true;
      } else {
        a.audio.pause();
        btn.classList.remove('active');
        playing = false;
      }
    });
  });

}

/* ======================
   START
====================== */

preloadAll();
</script>

</body>
</html>
